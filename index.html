
<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8">

    <style>

      #mapid { height: 480px; }
    </style>

    <!-- leaflet.js -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
          integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
            integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
            crossorigin=""></script>


    <link rel="stylesheet" type="text/css" href="styles.css">
    <style>

      html,body{
        height:100%;
      }

      #mapid{
        height:70%;
      }

      #debugMsgBox{
        height:30%;
      }

    </style>
  </head>

  <body>

    <div id="mapid"></div>

    <div id="debugMsgBox"></div>


    <script src="logging.js"></script>
    <script src="coordinates.js"></script>
    <script src="graphentities.js"></script>
    <script src="geodata.js"></script>
    <script>
      Log.init(document.getElementById("debugMsgBox"));
      Log.info("Log framework started");

      //Leaflet.js
      var mymap = L.map('mapid').setView([37.565149, 126.938016], 16);
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox.streets',
        accessToken: 'pk.eyJ1IjoiY2hhbnNvbDk4IiwiYSI6ImNqZ25henV1dTJibjgycXBxeGczaWk2enMifQ.w474LPaUpTnZiQnw5E3Ujg'
      }).addTo(mymap);
      /*
      L.marker([37.5602,126.9368]).addTo(mymap)
        .bindPopup('Yonsei Univ.')
        .openPopup();

      L.marker([37+33/60+48.7865/3600,126+56/60+15.2713/3600]).addTo(mymap)
        .bindPopup('Front of library')
        .openPopup();
        */


      var currentLocationMarker=L.marker(L.latLng(CoordinateConversions.centerCoords.lat,
                                                  CoordinateConversions.centerCoords.long),
                                         {"title":"Your location","autoPan":true});
      currentLocationMarker.addTo(mymap);



      //Geolocation
      function locationCallback(position){
        Log.verbose(position.coords.latitude+","+position.coords.longitude);

        var latlng=L.latLng(position.coords.latitude,position.coords.longitude);
        currentLocationMarker.setLatLng(latlng);
      }function locationErrorCallback(positionError){
        Log.warning("Error Callback: "+positionError.code+" | "+positionError.message);
      }

      if ("geolocation" in navigator) {
        Log.info("Geolocation available.");

        options = {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        };

        var watchID = navigator.geolocation.watchPosition(locationCallback,locationErrorCallback,options);
        Log.debug("watchPosition done");
      } else {
        Log.warning("Geolocation NOT available.");
      }

      //setInterval(function(){Log.verbose("yay");},1000);
      //Log.debug("DB");
      //Log.verbose("VB");
      //Log.setVisibility({"level1":true,"level2":false,"level3":true,"level4":true,"level5":true})
    </script>
  </body>


</html>
